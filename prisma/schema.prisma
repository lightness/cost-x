generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model CurrencyRate {
  id           Int      @id(map: "PK_currency_rate_id") @default(autoincrement())
  createdAt    DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  date         DateTime @db.Date
  rate         Decimal  @db.Decimal
  fromCurrency Currency @map("from_currency")
  toCurrency   Currency @map("to_currency")

  @@map("currency_rate")
}

model Item {
  id            Int       @id(map: "PK_item_id") @default(autoincrement())
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt     DateTime  @default(now()) @map("updated_at") @db.Timestamp(6)
  title         String    @db.VarChar(255)
  workspaceId   Int       @map("workspace_id")
  itemTag       ItemTag[]
  payment       Payment[]
  workspace     Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_item_workspace_id_workspace_id")

  @@map("item")
}

model ItemTag {
  id        Int      @id(map: "PK_item_tag_id") @default(autoincrement())
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @default(now()) @map("updated_at") @db.Timestamp(6)
  itemId    Int      @map("item_id")
  tagId     Int      @map("tag_id")
  item      Item     @relation(fields: [itemId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_item_tag_item_id_item_id")
  tag       Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_item_tag_tag_id_tag_id")

  @@unique([itemId, tagId], map: "UQ_item_tag_item_id_tag_id")
  @@map("item_tag")
}

model Migration {
  id        Int    @id(map: "PK_migration_id") @default(autoincrement())
  timestamp BigInt
  name      String @db.VarChar

  @@map("migration")
}

model Payment {
  id        Int      @id(map: "PK_payment_id") @default(autoincrement())
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime @default(now()) @map("updated_at") @db.Timestamp(6)
  cost      Decimal  @db.Decimal
  itemId    Int      @map("item_id")
  date      DateTime @db.Date
  title     String?  @db.VarChar
  currency  Currency
  item      Item     @relation(fields: [itemId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_payment_item_id_item_id")

  @@map("payment")
}

model Tag {
  id        Int       @id(map: "PK_tag_id") @default(autoincrement())
  createdAt DateTime  @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime  @default(now()) @map("updated_at") @db.Timestamp(6)
  title     String    @db.VarChar(100)
  color     String    @default("000000") @db.VarChar(6)
  itemTag   ItemTag[]

  @@map("tag")
}

enum Currency {
  BYN
  USD
  EUR
}

model User {
  id          Int         @id(map: "PK_user_id") @default(autoincrement())
  createdAt   DateTime    @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt   DateTime    @default(now()) @map("updated_at") @db.Timestamp(6)
  email       String      @db.VarChar(255)
  password    String      @db.VarChar(72)
  name        String      @db.VarChar(50)
  role        UserRole    @default(USER)
  status      UserStatus
  tempCode    String?
  workspaces  Workspace[]

  @@map("user")
}

enum UserStatus {
  ACTIVE
  EMAIL_NOT_VERIFIED
  BANNED
}

enum UserRole {
  USER
  ADMIN
}

model Workspace {
  id        Int         @id(map: "PK_workspace_id") @default(autoincrement())
  createdAt DateTime    @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt DateTime    @default(now()) @map("updated_at") @db.Timestamp(6)
  title     String      @db.VarChar(255)
  ownerId   Int         @map("owner_id")
  items     Item[]

  owner     User        @relation(fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_workspace_owner_id_user_id")

  @@map("workspace")
}